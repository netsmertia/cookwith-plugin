


{% set recipes = __SELF__.allRecipes() %}
{% set has_ads = __SELF__.property('space_code') %}
{% set url = __SELF__.property('section_view_more_url') %}
{% set cols = has_ads ? 3 : 4 %}
{% if has_ads %}
    {% set adSpace = __SELF__.getAd() %}
    {{debug(adSpace.toArray())}}
    {% if adSpace.is_random_ad and adSpace.ads.count() > 0  %}
        {% set ad  =  adSpace.ads.random() %}
    {% else %}
        {% set ad  =  adSpace.ads.sortBy('updated_at').first() %}
    {% endif %}
    {% set cols = adSpace.count > 0 and ad.count() > 0 ? 3 : 4 %}
{% endif %}

<section class="pt-6 container-fluid container-lg">
		<div class="row">
			<div class="col-md-{{has_ads ? 9 : 12}} d-flex justify-content-between">
                {% if __SELF__.property('section_title') %}
                    <h3 class="mb-3">{{__SELF__.property('section_title')|_}}</h3>
                {% endif %}
                {% if url %}
                    <div>
                        <a href="{{'category-page'|page({category: url})}}" class="btn btn-primary">{{'View More'|_}}</a>
                    </div>
                {% endif %}
			</div>
		</div>
        {% if  has_ads and adSpace.count() > 0 and ad.count() > 0 %}
            <div class="row">
                <div class="col-md-8 col-lg-9">
        {% endif %}
                    <div class="row">
                        {% for i in recipes %}
                            <div class="col-md-6 col-lg-{{12/cols}} mb-4 px-10px d-flex">
                                {% partial '@post-card-p'  item=i %}
                            </div>
                        {% endfor %}
                    </div>
        {% if has_ads and adSpace.count() > 0 and ad.count() > 0 %}

                </div>
                {# Show vertical ad #}
                {% if adSpace.count() > 0 and ad.count() > 0 %}
                    {% if adSpace.space_type == 'V' or adSpace.space_type == 'B' %}
                        {% if ad.is_image %}
                            <div class="col-md-4 col-lg-3 d-flex justify-content-center">
                            <a href="{{ad.url}}">
                                <img src="{{ad.image.path}}" alt="vertical add" class="img-fluid align-self-start">
                            </a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        {% endif %}
</section>
